<!doctype html>
<html lang="en" data-theme="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="./css/reset.css">
  <link rel="stylesheet" href="./css/typography.css">
  <link id="cd-base-part-1" rel="stylesheet" href="./css/icons.css">
  <link rel="stylesheet" href="./css/forms.css">
  <link rel="stylesheet" href="./css/header.css">
  <link rel="stylesheet" href="./css/date-picker.css">
  <link rel="stylesheet" href="./css/swipe.css">

  <!-- Component CSS -->
  <link id="codyframe" rel="stylesheet" href="./css/weekly-schedule.css">
  <!-- End Component CSS -->
  <link id="cd-cdf-util" rel="stylesheet" href="./css/util.css?v=1">
  <style>
    .height-25\% {
      height: 25%;
    }

    @media (min-width: 64rem) {
      .width-30\%\@md {
        width: 30%;
      }

      .width-70\%\@md {
        width: 70%;
      }

      .height-100\%\@md {
        height: 100%;
      }
    }
  </style>
  <script>
    document.documentElement.style.setProperty('--w-schedule-row-height', `${window.innerHeight / 14}px`);
  </script>
</head>

<body>
  <header class="header position-relative js-header ">
    <div class="header__container container max-width-lg">
      <div class="header__logo">
        <a href="#0">
          <svg width="150" height="50" viewBox="0 0 50 30" xmlns="http://www.w3.org/2000/svg">
            <text x="15" y="22" font-size="24" fill="var(--color-contrast-higher)" font-family="Impact, fantasy" font-weight="bold">EDT</text>
            <g fill="var(--color-primary)"><path d="m-1.946 14.952-1.47-1.47.678-.68.792.793L-.4 12.048l.679.68zm5.834-2.81H.938v2.95h2.95zm-.96 1.99h-1.03v-1.03h1.03zm-11.753-1.99h-2.95v2.95h2.95zm-.96 1.99h-1.03v-1.03h1.03zm5.201-1.99h-2.95v2.95h2.95zm-.96 1.99h-1.03v-1.03h1.03zm9.432-5.795H.938v2.95h2.95zm-.96 1.99h-1.03v-1.03h1.03zm-11.753-1.99h-2.95v2.95h2.95zm-.96 1.99h-1.03v-1.03h1.03zm5.201-1.99h-2.95v2.95h2.95zm-.96 1.99h-1.03v-1.03h1.03zm5.201-1.99h-2.95v2.95h2.95zm-.96 1.99h-1.03v-1.03h1.03zm2.241 8.57h2.95v-2.949H.938zm.96-1.989h1.03v1.03h-1.03zm-13.673 1.99h2.95v-2.95h-2.95zm.96-1.99h1.03v1.03h-1.03zm3.281 1.99h2.95v-2.95h-2.95zm.96-1.99h1.03v1.03h-1.03zm3.281 1.99h2.95v-2.95h-2.95zm.96-1.99h1.03v1.03h-1.03z"/><path d="M-9.745 21.154v.48A2.37 2.37 0 0 1-12.06 24a2.376 2.376 0 0 1-2.316-2.366V6.081H6.49v13.76h.96V1.7H3.584A2.252 2.252 0 0 0-.394.792a2.25 2.25 0 0 0-3.55 0 2.25 2.25 0 0 0-3.55 0 2.251 2.251 0 0 0-3.977.907h-3.865v1.594h-2.542v24.14H3.35V24.96h4.163a3.33 3.33 0 0 0 3.326-3.327v-.48zM1.381.885c.545 0 1.01.339 1.202.815H.18a1.3 1.3 0 0 1 1.2-.815m-3.55 0c.545 0 1.011.339 1.202.815H-3.37A1.3 1.3 0 0 1-2.168.885m-3.55 0c.544 0 1.01.339 1.201.815H-6.92A1.3 1.3 0 0 1-5.718.885m-3.55 0a1.3 1.3 0 0 1 1.202.815h-2.404A1.3 1.3 0 0 1-9.268.885m-5.108 1.775h2.905a2.26 2.26 0 0 0 2.203 1.775v-.96c-.544 0-1.01-.338-1.202-.815h2.549a2.26 2.26 0 0 0 2.203 1.775v-.96c-.544 0-1.01-.338-1.202-.815h2.549a2.26 2.26 0 0 0 2.203 1.775v-.96c-.545 0-1.01-.338-1.202-.815h2.548a2.26 2.26 0 0 0 2.203 1.775v-.96c-.544 0-1.01-.338-1.201-.815h6.31v2.46h-20.866zm-2.542 1.594h1.582V6.4h-1.582zm19.306 22.22h-19.306V7.36h1.582v14.274a3.34 3.34 0 0 0 3.225 3.324v.003l.045-.001H2.39zm5.124-2.473H-9.777a3.32 3.32 0 0 0 .958-1.887H9.829A2.37 2.37 0 0 1 7.512 24"/><text y="601.6" font-size="25.6" font-weight="bold" font-family="Arbeit Regular, Helvetica, Arial-Unicode, Arial, Sans-serif" fill="#000" transform="matrix(.08 0 0 .08 -24 -6.8)">Created by Rafiico Creative Studio</text><text y="627.2" font-size="25.6" font-weight="bold" font-family="Arbeit Regular, Helvetica, Arial-Unicode, Arial, Sans-serif" fill="#000" transform="matrix(.08 0 0 .08 -24 -6.8)">from Noun Project</text></g></svg>
        </a>
      </div>

      <div class="date-input js-date-input"><label for="date-input-1" class="form-label margin-bottom-2xs">Select date<i
            class="sr-only">, format is dd/mm/yyyy</i>:</label>
        <div class="date-input__wrapper"><input type="text"
            class="form-control width-100% date-input__text js-date-input__text" placeholder="dd/mm/yyyy"
            autocomplete="off" id="date-input-1"> <button class="date-input__trigger js-date-input__trigger"
            aria-label="Select date using calendar widget" type="button"><svg class="icon" aria-hidden="true"
              viewBox="0 0 20 20">
              <g fill="none" stroke="currentColor" stroke-linecap="square" stroke-miterlimit="10" stroke-width="2">
                <rect x="1" y="4" width="18" height="14" rx="1"></rect>
                <line x1="5" y1="1" x2="5" y2="4"></line>
                <line x1="15" y1="1" x2="15" y2="4"></line>
                <line x1="1" y1="9" x2="19" y2="9"></line>
              </g>
            </svg></button></div>
        <div class="date-picker js-date-picker" role="dialog" aria-labelledby="calendar-label-1"
          style="left: 0px; right: auto;">
          <header class="date-picker__header">
            <div class="date-picker__month"><span class="date-picker__month-label js-date-picker__month-label"
                id="calendar-label-1"></span><!-- this will contain month label + year -->
              <nav>
                <ul class="date-picker__month-nav js-date-picker__month-nav">
                  <li><button
                      class="date-picker__month-nav-btn js-date-picker__month-nav-btn js-date-picker__month-nav-btn--prev"
                      type="button"><svg class="icon icon--xs" viewBox="0 0 16 16">
                        <title>Previous month</title>
                        <polyline points="10 2 4 8 10 14" fill="none" stroke="currentColor" stroke-linecap="round"
                          stroke-linejoin="round" stroke-width="2"></polyline>
                      </svg></button></li>
                  <li><button
                      class="date-picker__month-nav-btn js-date-picker__month-nav-btn js-date-picker__month-nav-btn--next"
                      type="button"><svg class="icon icon--xs" viewBox="0 0 16 16">
                        <title>Next month</title>
                        <polyline points="6 2 12 8 6 14" fill="none" stroke="currentColor" stroke-linecap="round"
                          stroke-linejoin="round" stroke-width="2"></polyline>
                      </svg></button></li>
                </ul>
              </nav>
            </div>
            <ol class="date-picker__week">
              <li>
                <div class="date-picker__day">M<span class="sr-only">onday</span></div>
              </li>
              <li>
                <div class="date-picker__day">T<span class="sr-only">uesday</span></div>
              </li>
              <li>
                <div class="date-picker__day">W<span class="sr-only">ednesday</span></div>
              </li>
              <li>
                <div class="date-picker__day">T<span class="sr-only">hursday</span></div>
              </li>
              <li>
                <div class="date-picker__day">F<span class="sr-only">riday</span></div>
              </li>
              <li>
                <div class="date-picker__day">S<span class="sr-only">aturday</span></div>
              </li>
              <li>
                <div class="date-picker__day">S<span class="sr-only">unday</span></div>
              </li>
            </ol>
          </header>
          <ol class="date-picker__dates js-date-picker__dates" aria-labelledby="calendar-label-1">
            <!-- days will be created using js --></ol>
        </div>
        <div aria-live="polite" class="sr-only js-date-input__sr-live"></div>
      </div>

      <button class="btn btn--subtle header__trigger js-header__trigger" aria-label="Toggle menu" aria-expanded="false"
        aria-controls="header-nav">
        <i class="header__trigger-icon" aria-hidden="true"></i>
      </button>

      <nav class="header__nav js-header__nav" id="header-nav" role="navigation" aria-label="Main">
        <div class="header__nav-inner">
          <div class="header__label">Main menu</div>
          <ul class="header__list">
            <li class="header__item"><a href="#0" class="header__link">Param√®tre </a></li>
            <li class="header__item"><a href="./html/edit.html" target="modal" class="header__link">√âdition</a></li>
            <li class="header__item header__item--divider" aria-hidden="true"></li>
            <li class="header__item"><a href="./html/sign_out.html" target="modal" class="header__link">Se
                D√©connecter</a></li>
          </ul>
        </div>
      </nav>
    </div>
  </header>
  <div class="container max-width-xl padding-y-sm js-cd-demo">
    <!-- Component HTML -->
    <div class="w-schedule js-tabs js-w-schedule tabs--no-interaction swiper" data-hide-panel-class="display@md"
      data-w-schedule-timeline="08:00-19:00" style="overflow: hidden; ">
      <!-- üëá events -->
      <div class="w-schedule__days js-tabs__panels swiper-wrapper" , style="width: fit-content;">
        <!-- dynamically generated -->
      </div><!-- background rows -->
      <div class="w-schedule__grid js-w-schedule__grid" aria-hidden="true">
        <!-- dynamically generated -->
      </div>
    </div><!-- modal window (weekly schedule) -->
    <div id="w-schedule-modal-id"
      class="w-schedule-modal modal modal--animate-fade bg-black bg-opacity-90% js-w-schedule-modal js-modal">
      <div
        class="w-schedule-modal__content modal__content bg radius-md inner-glow shadow-md opacity-0 flex@md js-w-schedule-modal__content"
        role="alertdialog" aria-label="Event Info"><!-- modal content is dynamically loaded -->
        <div class="ske height-25% width-30%@md height-100%@md" aria-hidden="true"></div>
        <div class="padding-md width-70%@md height-100%@md" aria-hidden="true">
          <ul class="grid gap-xs">
            <li class="col-3 padding-bottom-sm">
              <div class="ske ske--text text-xl"></div>
            </li>
            <li>
              <div class="ske ske--text"></div>
            </li>
            <li>
              <div class="ske ske--text"></div>
            </li>
            <li class="col-6">
              <div class="ske ske--text"></div>
            </li>
          </ul>
        </div><!-- [end] modal content -->
      </div>
    </div><!-- modal content clone - used for morphing bg -->
    <div class="w-schedule-morph-bg bg radius-md hide js-w-schedule-morph-bg" aria-hidden="true"></div><button
      class="w-schedule-close-btn js-w-schedule-close-btn"><svg class="icon icon--sm" viewBox="0 0 24 24">
        <title>Close modal window</title>
        <g fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round">
          <line x1="3" y1="3" x2="21" y2="21"></line>
          <line x1="21" y1="3" x2="3" y2="21"></line>
        </g>
      </svg></button>
    <!-- [end] modal window (weekly schedule) -->

    <!-- End Component HTML -->
  </div>
  <!-- Component JS -->
  <script src="./js/weekly-schedule.min.js"></script>
  <script src="./js/header.js"></script>
  <script src="./js/date-picker.js"></script>
  <!-- Swiper JS -->
  <script src="./js/swiper-bundle.min.js"></script>
  <script src="./js/populate.js"></script>

  <!-- End Component JS -->

  <script>

    var wSchedule = document.getElementsByClassName('js-w-schedule')[0];

    var searchValues = [
      { id: 1, content: '<a class="w-schedule-modal__figure height-25% width-30%@md height-100%@md" href="#0"><img src="./img/weekly-schedule-img-1.jpg" alt="Image description"></a><div class="w-schedule-modal__body padding-md width-70%@md height-100%@md"><div class="text-component"><h1 class="text-xl">Abs Circuit</h1><p class="color-contrast-medium">Lorem ipsum dolor sit amet consectetur adipisicing elit. Aspernatur et labore esse mollitia. Pariatur error nesciunt ab illum.</p><p class="color-contrast-medium">Lorem ipsum dolor sit amet consectetur adipisicing elit. Dicta placeat ex sunt?</p><p><button class="btn btn--primary">Book Class</button></p></div></div>' },
      { id: 2, content: '<a class="w-schedule-modal__figure height-25% width-30%@md height-100%@md" href="#0"><img src="./img/weekly-schedule-img-maths.png" alt="Image description"></a><div class="w-schedule-modal__body padding-md width-70%@md height-100%@md"><div class="text-component"><h1 class="text-xl">Rowing Workout</h1><p class="color-contrast-medium">Lorem ipsum dolor sit amet consectetur adipisicing elit. Aspernatur et labore esse mollitia. Pariatur error nesciunt ab illum.</p><p class="color-contrast-medium">Lorem ipsum dolor sit amet consectetur adipisicing elit. Dicta placeat ex sunt?</p><p><button class="btn btn--primary">Book Class</button></p></div></div>' },
      { id: 3, content: '<a class="w-schedule-modal__figure height-25% width-30%@md height-100%@md" href="#0"><img src="./img/weekly-schedule-img-3.jpg" alt="Image description"></a><div class="w-schedule-modal__body padding-md width-70%@md height-100%@md"><div class="text-component"><h1 class="text-xl">Yoga Level 1</h1><p class="color-contrast-medium">Lorem ipsum dolor sit amet consectetur adipisicing elit. Aspernatur et labore esse mollitia. Pariatur error nesciunt ab illum.</p><p class="color-contrast-medium">Lorem ipsum dolor sit amet consectetur adipisicing elit. Dicta placeat ex sunt?</p><p><button class="btn btn--primary">Book Class</button></p></div></div>' },
      { id: 4, content: '<a class="w-schedule-modal__figure height-25% width-30%@md height-100%@md" href="#0"><img src="./img/weekly-schedule-img-4.jpg" alt="Image description"></a><div class="w-schedule-modal__body padding-md width-70%@md height-100%@md"><div class="text-component"><h1 class="text-xl">Restorative Yoga</h1><p class="color-contrast-medium">Lorem ipsum dolor sit amet consectetur adipisicing elit. Aspernatur et labore esse mollitia. Pariatur error nesciunt ab illum.</p><p class="color-contrast-medium">Lorem ipsum dolor sit amet consectetur adipisicing elit. Dicta placeat ex sunt?</p><p><button class="btn btn--primary">Book Class</button></p></div></div>' }
    ];
    let my_schedule = new WSchedule({
      element: wSchedule,
      searchData: function (trigger, cb) {
        if (trigger.isFakeTrigger) {
          return setTimeout(function () {
            cb(trigger.getModalContent());
          }, 500);
        }
        var event = trigger.getAttribute('data-w-schedule-event') || 1;
        var data = searchValues.filter(function (item) {
          return item['id'] == event;
        });
        // wait to load the image
        loadImage(event, function () {
          setTimeout(function () {
            cb(data[0]['content']);
          }, 1000);
        });
      }
    });

    function loadImage(id, cb) {
      var src = './img/weekly-schedule-img-1.jpg';//'./img/weekly-schedule-img-' + id + '.jpg';
      var image = new Image();
      var loaded = false;
      image.onload = function () {
        if (loaded) return;
        cb();
      }
      image.src = src;
      if (image.complete) {
        loaded = true;
        cb();
      }
    };


    function showCustomModal(content) {
      e = my_schedule.modal[0]
      // Cr√©e un fake trigger
      const mockTrigger = {
        closest(selector) {
          return {
            getBoundingClientRect() {
              return { top: 100, left: 100, width: 200, height: 100, right: 300, bottom: 200 };
            },
            getAttribute(attr) {
              return null;
            },
            getModalContent() {
              return content;
            },
            isFakeTrigger: true
          }
        },
        focus() {
          return null;
        }
      };

      e.dispatchEvent(new CustomEvent("openModal", { detail: mockTrigger }));
    }

    async function loadModalFromURL(url) {
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error(`Erreur HTTP ${res.status}`);

        const html = await res.text();

        showCustomModal(html);
      } catch (err) {
        console.error('Erreur chargement modal HTML:', err);
        alert('Erreur chargement contenu');
      }
    }

    document.addEventListener("click", function (e) {
      const link = e.target.closest('a[target="modal"]');
      if (link) {
        e.preventDefault(); // emp√™che le chargement normal
        const url = link.getAttribute("href");
        if (url) loadModalFromURL(url);
      }
    });
  </script>

  <!-- Initialize Swiper -->
  <script>
    const container = document.querySelector('.swiper .swiper-wrapper');

    // Utilitaire circulaire
    function getDay(index) {
      const day_id = index % 7;
      const week_id = (index - day_id) / 7;
      console.log(`week : ${week_id}`)
      return {
        id: `${index}`, name: "Lundi", events: [
          { id: 1, name: "Abs Circuit", datetime: "09:30PT1H" },
          { id: 2, name: "Rowing Workout", datetime: "11:00PT1H30M" },
          { id: 3, name: "Yoga Level 1", datetime: "14:00PT1H15M" }
        ]
      };
    }

    function renderSlide(index) {
      return generateScheduleDay(getDay(index)).outerHTML;
    }

    // Index logique du centre
    let currentIndex = 0;

    // D√©tecte combien de slides sont visibles en fonction de l‚Äô√©cran
    function getVisibleCount() {
      return window.innerWidth >= 1024 ? 7 : 1;
    }

    // Met √† jour les slides visibles autour du centre
    function updateSlides(centerIndex) {
      const visible = getVisibleCount();
      container.innerHTML = '';
      for (let i = 1; i <= 3 * visible; i++) {
        container.insertAdjacentHTML('beforeend', renderSlide(centerIndex + i));
      }
      my_schedule.update(); // ta fonction custom
    }

    // Initial setup
    updateSlides(currentIndex);

    // Instancie Swiper
    const swiper = new Swiper('.swiper', {
      initialSlide: getVisibleCount(),
      allowTouchMove: true,
      observeParents: true,
      slidesPerView: getVisibleCount(),
      slidesPerGroup: getVisibleCount(),
      spaceBetween: 10,
      breakpoints: {
        1024: {
          slidesPerView: 7,
          slidesPerGroup: 7,
          spaceBetween: 0
        }
      },
      on: {
        slideChangeTransitionEnd: function () {
          const visible = getVisibleCount();

          const realIndex = this.activeIndex;

          if (realIndex > visible) {
            currentIndex += visible;
          } else if (realIndex < visible) {
            currentIndex -= visible;
          }

          updateSlides(currentIndex);
          this.update();
          this.slideTo(visible, 0);
        }
      }
    });

    // Facultatif : reload si on change de taille d'√©cran de fa√ßon significative
    window.addEventListener('resize', () => {
      const newVisible = window.innerWidth >= 1024 ? 7 : 1;
      const currentVisible = swiper.params.slidesPerView;
      if (newVisible !== currentVisible) {
        location.reload(); // Reload propre si changement de mode
      }
    });
  </script>
  <script>
    window.addEventListener('DOMContentLoaded', async () => {
      const res = await fetch('/auth/status');
      const status = await res.json();

      if (!status.connected) {
        // utilisateur non connect√© => on affiche le modal de connexion
        loadModalFromURL("/html/sign_in.html");
      }
    });
  </script>
</body>

</html>